{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}一般アカウント一覧{% endblock %}

{% block content %}
<ul>
    {% for profile in profiles %}
        <li>
            <img src="{% if profile.profile_image %}{{ profile.profile_image.url }}{% else %}{% static 'default_profile_image.png' %}{% endif %}" 
                 alt="Profile Image" width="50">
            <strong>
                <a href="{% url 'accounts:general_account_detail' user_id=profile.user.id %}">
                    {{ profile.user.name }}
                </a>
            </strong> - {{ profile.get_gender_display }}
            <button class="like-btn" data-user-id="{{ profile.user.id }}">
                👍 {{ profile.likes_count }}
            </button>
        </li>
    {% endfor %}
</ul>

<script>
    document.querySelectorAll('.like-btn').forEach(button => {
        button.addEventListener('click', function () {
            const userId = this.getAttribute('data-user-id');
            fetch("{% url 'accounts:like_toggle' %}", {
                method: 'POST',
                headers: { 
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({ 'user_id': userId })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    this.textContent = `👍 ${data.likes_count}`;
                }
            });
        });
    });
</script>
{% endblock %}
